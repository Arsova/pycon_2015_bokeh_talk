{% extends "base.html" %}

{% load i18n %}
{% load static from staticfiles %}

{% block title %}Washmap{% endblock %}

{% block content %}
    
    <div class="row title">
        <div class="content">
            <h1>WASHMAP</h1>
        </div>
        {% for figure in figures %}
        <div class="figure-wrapper">
            <div id="{{ figure.elementid }}" class="plotdiv" data-min-width="700"></div>
        </div>
        {% endfor %}
    </div>

{% endblock content %}
{% block extra_javascript %}
    <script>
        bokehJS.done( function () {
            {% for figure in figures %}
                {% include 'main/snippets/bokeh_script.js' %}
            {% endfor %}
           resize_figures();
        });
        function resize_figures() {
            var width, plot_width, plot_height;
            {% for figure in figures %}
                element = $("#{{ figure.elementid }}");
                element_width = element.width();
                element_min_width = element.attr("data-min-width");
                element.removeClass("screen-too-small");
                if ( element_width < element_min_width ) {
                   element.addClass("screen-too-small"); 
                }

                cur_width = $("#{{ figure.elementid }} .bk-canvas-wrapper").width();
                cur_height = $("#{{ figure.elementid }} .bk-canvas-wrapper").height();
                aspect_ratio = cur_width / cur_height;
                plot_width = Math.max(element_width, 300);
                plot_height = parseInt(plot_width / aspect_ratio);
                Bokeh.Collections('Plot').get("{{ figure.modelid }}").set('plot_width', plot_width);
                Bokeh.Collections('Plot').get("{{ figure.modelid }}").set('plot_height', plot_height);
            {% endfor %}
        }
    </script>
{% endblock extra_javascript %}
