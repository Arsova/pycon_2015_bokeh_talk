<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Interactive data for the web</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/pycon.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

<!-- Any section element inside of this container is displayed as a slide -->
<div class="slides">
    <section>
        <h1>Interactive data for the web</h1>
        <h3>Bokeh for web developers</h3>
        <p>Sarah Bird</p>
        <p><a href="#">github url</a></p>
        <img class="slide_image" data-src="images/sanitation screenshot.png">
    </section>

    <section>
        <section>
            <h2>Bokeh</h2>
            <ul>
                <li>Data visualization libary</li>
                <li>Web</li>
                <li>Interactive</li>
                <li>Roots in data science</li>
            </ul>
            <img class="slide_image" data-src="images/bokeh screenshot.png">
            <aside class="notes">
                <p>Bokeh is a Python interactive visualization library that
                targets modern web browsers for presentation. Its goal is
                to provide elegant, concise construction of novel graphics
                in the style of D3.js, but also deliver this capability
                with high-performance interactivity over very large or
                streaming datasets. Bokeh can help anyone who would like to
                quickly and easily create interactive plots, dashboards,
                and data applications.</p>

                <p>
                Show of hands for data scientists vs web developers.
                </p>
            </aside>
        </section>
        <section>
            <img class="stretch" data-src="images/bokeh_alot.png">
            <div class="attribution">
                <img data-src="images/copyright_hyperbole_half.png">
                <p><a href="http://hyperboleandahalf.blogspot.ca/2010/04/alot-is-better-than-you-at-everything.html">hyperbole and a half - the alot</a></p>
            </div>
        </section>
        <section>
            <img class="stretch" data-src="images/alot_more_python_2.png">
            <div class="attribution">
                <img data-src="images/copyright_hyperbole_half.png">
                <p><a href="http://hyperboleandahalf.blogspot.ca/2010/04/alot-is-better-than-you-at-everything.html">hyperbole and a half - the alot</a></p>
            </div>
        </section>
        <section>
            <h2>Why bokeh?</h2>
            <ul>
                <li>python vs javascript</li>
                <li>mid-data (and big-data)</li>
                <li>real-time data updates</li>
                <li>server-side processing</li>
            </ul>
            <p>My new default</p>
        </section>
        <section>
            <img data-src="images/washwatch_original.png" class="stretch">
            <div style="font-size:0.8em">
                <p>
                    <a href="http://www.wateraid.org/what-we-do/the-crisis/africa-wash-map#/interactive-map">http://www.wateraid.org/what-we-do/the-crisis/africa-wash-map</a><br />
                    <a href="https://github.com/aptivate/africawatermap">https://github.com/aptivate/africawatermap</a><br />
                    <a href="http://www.aptivate.org">Aptivate</a> | <a href="http://d3js.org">d3.js</a><br />
                    WASH = <span class="highlight">wa</span>ter, <span class="highlight">s</span>anitation & <span class="highlight">h</span>ygiene
                </p>
            </div>
        </section>
        <section>
            <iframe src="http://africawatermap.aptivate.org/index.html" width="900" height="1000" frameborder="0"></iframe>
        </section>
        <section>
            <p>
                <img data-src="images/washwatch_original.png" class="side_by_side left">
                <img data-src="images/water_screenshot.png" class="side_by_side right">
            </p>
            <p><a style="float: left;" href="https://github.com/birdsarah/XXX">Code URL</a></p>
        </section>
        <!-- END SECTION 1 -->
    </section>
    <section>
        <!-- START SECTION 2 -->
        <section>
        <h2>Charts interface</h2>
        <pre class="fragment"><code class="python" data-trim>
..views.py
    from bokeh.charts import Line
    from bokeh.embed import components, Resources

    chart = Line(data)
    embed_script, embed_div = components(chart, resources=Resources())
        </code></pre>
        <pre class="fragment"><code class="django" data-trim>
..template.html

    <script src="js/bokeh.min.js"></script>
    <link rel="stylesheet" href="css/bokeh.min.css" /> 

    {{ embed_div|safe }}
    {{ embed_script|safe }}
        </code></pre>
        </section>

        <section>
            <iframe data-src="http://localhost:8001/line" width="800" height="550" frameborder="0"></iframe>
            <h3 class="fragment"><code>chart = Line(data)</code></h3>
        </section>

        <section>
            <img class="stretch" data-src="images/bokeh_basic.svg">
        </section>

        <section>
        <h2>Getting the data</h2>
        <p>data - DataFrame - <a href="http://pandas.pydata.org">pandas.pydata.org</a></p>
        <pre><code class="python" data-trim>
In[4]: data.head()

Out[4]:
    year    value
    1990    42.4
    1991    42.4
    1992    42.4
    1993    42.4
    1994    43.0
        </code></pre>
        </section>
        <section>
        <h2>Getting the data</h2>
        <h4>Django Queryset</h4>
        <pre><code class="python" data-trim>
..views.py

from pandas import DataFrame
from .models import StatValue

stats = StatValue.objects.filter(description__code=stat_code)
stats = stats.values('value', 'year', 'country_id')
stats_df = DataFrame.from_records(stats, coerce_float=True)
        </code></pre>
            <div class="attribution">
                <p><a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.from_records.html">http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.from_records.html</a>
            </div>

        <div class="fragment">
            <h4>Raw SQL</h4>
            <pre><code class="python" data-trim>
    import pandas as pd

    from sqlalchemy import create_engine
    engine = create_engine('sqlite:///:memory:')
    data_from_table = pd.read_sql_table('data', engine)
    data_from_query = pd.read_sql_query('SELECT * FROM data', engine)
            </code></pre>
            <div class="attribution">
                <p><a href="http://pandas.pydata.org/pandas-docs/stable/io.html#io-sql">http://pandas.pydata.org/pandas-docs/stable/io.html#io-sql</a>
            </div>
        </div>
        </section>
        <!-- END SECTION 2 -->
    </section>
    <section>
        <!-- START SECTION 3 -->
        <section>
            <p>pandas.DataFrame,  bokeh.charts.Line</p>
            <p>
                <img data-src="images/screenshot_line.png" class="side_by_side left">
                <img data-src="images/Grumpy_Cat_by_Gage_Skidmore_cropped.jpg" class="fragment side_by_side right">
            </p>
            <div class="attribution fragment">
                <p><a href="https://en.wikipedia.org/wiki/Grumpy_Cat#/media/File:Grumpy_Cat_by_Gage_Skidmore.jpg">Gage Skidmore</a>
            </div>
            <h2 class="fragment highlight">NOT PRETTY</h2>
            <aside class="notes">
            <p>We had out DataFrame and our charts function. Bokeh turns that 
            into JSON and bokehjs turns it into javascript. So we're feeling pretty good.

            Click twice (or three times) on cat!
            </p>
            </aside>
        </section>
        <section>
            <iframe src="http://localhost:8888/notebooks/_1_prettify_chart.ipynb#/slide-0-0" width=1024 height=600></iframe>
        </section>
        <section>
            <img class="stretch" data-src="images/bokeh_with_high_low.svg">
        </section>
        <section>
            <h2>Charts Intermission</h2>
            <ul>
                <li>Charts are awesome!</li>
                <li>Area, Bar, BoxPlot, Donut, Dot, HeatMap, Histogram, Horizon, Line, Scatter, Step, TimeSeries</li>
                <li>Great way to get started</li>
                <li>Code is interesting for learning bokeh
                    <ul>
                        <li><pre>bokeh/bokeh/charts/builder/*_builder.py</pre></li>
                    </ul>
                </li>
            </ul>
            <aside class="notes">
            <p>I have a pull request that I'm going to finish in the 
            during the sprints where I show an example of making a sparkline
            starting from a line chart.
            </p>
            </aside>
        </section>
        <!-- END SECTION 3 -->
    </section>
    <section>
        <!-- START SECTION 4 -->
        <section>
            <img data-src="images/water_screenshot.png" class="stretch">
        </section>
        <section>
            <h3>Plot</h3>
            <pre><code class="python" data-trim>
from bokeh.models import Plot

plot = Plot()
plot.add_glyph()
plot.add_layout()
plot.add_tools()
            </code></pre>
            <h3>Glyph (shape)</h3>
            <pre><code class="python" data-trim>
from bokeh.models import Rect, Circle, Line, Triangle, ...
            </code></pre>
            <h3>Tools (interactions)</h3>
            <pre><code class="python" data-trim>
from bokeh.models import (
    TapTool, HoverTool, 
    BoxSelectTool, BoxZoomTool, WheelZoomTool, PanTool,
    ResetTool, ResizeTool, ....
)
            </code></pre>
        </section>
        <section>
            <img data-src="images/burtin.png" class="stretch">
        </section>
        <section>
            <iframe src="http://localhost:8888/notebooks/_2_building_up.ipynb" width=1024 height=600></iframe>
        </section>
        <section>
            <h2>CSS Intermission</h2>
            <ul>
                <li>Canvas - no css required</li>
                <li>Bokeh needs some css - tools, hover styling, slider styling</li>
                <li>Bokeh's built-in css is large</li>
                <li>I prefer to roll my own
                    <ul>
                        <li><pre>bokeh/bokehjs/build/css/bokeh.css</pre></li>
                    </ul>
                </li>
            </ul>
        </section>
        <section>
            <h2>Embedding intermission</h2>
        <pre><code class="python" data-trim>
from bokeh.embed import components, Resources
embed_script, embed_div = components(chart, resources=Resources())
        </code></pre>
        <pre><code class="django" data-trim>
{{ embed_div|safe }}
{{ embed_script|safe }}
        </code></pre>
        <ul>
            <li>Want to load bokehjs async or ...</li>
            <li>Copy bokeh's templates to make your own
                <ul>
                    <li><pre>bokeh/bokeh/_templates/*</pre></li>
                </ul>
            </li>
            <li>Useful for making responsive plots</li>
        </ul>
        <p>See the talk repo</p>
        </section>
        <section>
            <h2>Widgets</h2>
        <pre><code class="python" data-trim>
from bokeh.models.widgets import Tabs, Panel
from bokeh.plotting import vplot, hplot
tabs = Tabs(
    tabs=[
        Panel(
            title="Water",
            child=hplot(vplot(water_map), vplot(water_line, water_key))
        ),
        Panel(
            title="Sanitation",
            child=hplot(vplot(san_map), vplot(san_line, san_key))
        )
    ]
)
        </code></pre>
        </section>
        <section>
            <iframe data-src="http://localhost:8001/static" width="900" height="1000" frameborder="0"></iframe>
        </section>
        <section>
            <h2>Hover</h2>
        <pre><code class="python" data-trim>
from bokeh.models import HoverTool
plot.add_tools(HoverTool(tooltips="@active_year"))
        </pre></code>
        <p>Use @ to reference your column name. You can attach a hover tool to a specific source if necessary.</p>
        <pre><code class="fragment python" data-trim>
tooltips = '<span class="tooltip-text year">@active_year</span>'
tooltips += '<span class="tooltip-text country">@name</span>'
tooltips += '<span class="tooltip-text value">@active_year_value %</span>'
plot.add_tools(HoverTool(tooltips=tooltips))
        </code></pre>
        <pre><code class="fragment css" data-trim>
.bk-tooltip.bk-tooltip-custom {
    background-color: black;
    opacity: 0.8;
}
.tooltip-text {
    clear: both;
    float: left;
}
        </code></pre>
        </section>
        <section>
            <iframe data-src="http://localhost:8001/static" width="900" height="1000" frameborder="0"></iframe>
        </section>
        <section>
            <h2>Linked sources</h2>
        <pre><code class="python" data-trim>
source = ColumnDataSource(data)
map.add_glyph(source, countries)
text_box.add_glyph(source, country_name)
        </pre></code>
        </section>
        <section>
            <iframe data-src="http://localhost:8001" width="900" height="500" frameborder="0"></iframe>
        </section>
        <!-- END SECTION 4 -->
    </section>
    <section>
        <!-- START SECTION 5 -->
        <section>
            <h2>Introducing bokeh server</h2>
            <img class="stretch" data-src="images/bokeh_with_server.svg">
        <aside class="notes">
            Now we introduce a new piece of bokeh - the bokeh server.
            The bokeh server lets you host plots and brings lots of really
            interesting functionality to the table.  We're going to do a simple
            example of connecting our plot to the bokeh server which will
            hopefully get you started and give you a taste of what's possible.

            Previously we generated our plot and passed it, as json, down to the 
            browser. In the server case. We build our plot and sent it to the 
            server. To the browser we send information of how to get the plot.
            The plot then makes a connection to the server. It first gets the json
            as before. In addition it sets up a websocket connection.

            There are now two scenarios. First, and the one that we're going to focus on today.
            When a user interacts with the plot, it triggers a REST call to the server. 
            We can then respond to these events.  In addition, and this will become clearer,
            the server can trigger udpates to the plot.
        </aside>
        </section>
        <section>
            <h2>Server app</h2>
            <p>Define app <span class="highlight">Instance</span>s</p>
            <pre class="fragment"><code class="python" data-trim>
from bokeh.properties import Instance

class WashmapApp(VBox):
    year = Instance(Slider)
    source = Instance(ColumnDataSource)
            </pre></code>
            <p class="fragment">Need this "blueprint" on the bokeh server and 
            your webapp server (if they're different).</p>
        </section>
        <section>
            <h2>Create plot (webapp)</h2>
            <pre><code style="max-height:800px" class="python" data-trim>
class WashmapApp(VBox):
    year = Instance(Slider)
    source = Instance(ColumnDataSource)

    @classmethod
    def create(cls):
        obj = cls()
        obj.year = Slider(
            title='Year', name='year',
            value=1990, start=1990, end=2012, step=1
        )
        data = get_data_from_database_and_convert_to_dataframe()
        obj.source = ColumnDataSource(data)
        obj.source.selected = [30]

        water_map = construct_map(obj.source)
        water_text = construct_text(obj.source)

        obj.children = [water_map, water_text, obj.year]
        return obj
            </pre></code>
        </section>
        <section>
        <iframe data-src="http://localhost:8001" width="900" height="1000" 
            style="margin-top:-50px; margin-left:150px;" frameborder="0"></iframe>
        </section>
        <section>
            <h2>Serve plot (bokeh server)</h2>
            <pre><code style="max-height:800px" class="python" data-trim>
class WashmapApp(VBox):
    year = Instance(Slider)
    source = Instance(ColumnDataSource)

    def setup_events(self):
        self.year.on_change('value', self, 'change_year')

    def change_year(self, obj, attrname, old, new):
        year = new
        data = self.source.to_df()
        new_data = manipulate_data(data, year)
        new_source = ColumnDataSource(new_data)
        self.source.data = new_source.data
            </pre></code>
        </section>
        <section>
        <iframe data-src="http://localhost:8001" width="900" height="1000" 
            style="margin-top:-50px; margin-left:150px;" frameborder="0"></iframe>
        </section>
        <!-- END SECTION 5 -->
    </section>
    <!-- SAMPLE SLIDES
    <section
        <h2>bullet slide</h2>
        <ul>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
    </section>
    -->
</div>

            <div class="footer">
                <p><i class="fa fa-twitter"></i> birdsarah</p>
            </div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: false,
				progress: false,
				history: true,
				center: false,

				transition: 'none', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});
            Reveal.configure({
                keyboard: {
                    49: 'toggleOverview'
                }
            });

		</script>

	</body>
</html>
